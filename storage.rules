
service firebase.storage {
  match /b/{bucket}/o {

    // Règle générique et sécurisée : l'écriture est autorisée dans n'importe quel 
    // dossier de premier niveau (ex: 'users/', 'avatars/', 'scheduledPosts/') 
    // à la condition que le chemin contienne l'UID de l'utilisateur authentifié.
    match /{folder}/{userId}/{allPaths=**} {
      allow read: if true; // La lecture est publique car les URLs ne sont pas devinables.
      allow write: if request.auth != null && request.auth.uid == userId;
    }
    
  }
}
