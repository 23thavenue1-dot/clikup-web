rules_version = '2';
service firebase.storage {
  match /b/{bucket}/o {
    // Dossier privé par utilisateur
    match /uploads/{uid}/{allPaths=**} {
      // Lecture/écriture strictement par le propriétaire
      allow read, delete: if request.auth != null && request.auth.uid == uid;

      // Ecriture : propriétaire + garde taille/type (optionnel mais recommandé)
      allow write: if request.auth != null
        && request.auth.uid == uid
        && request.resource.size < 10 * 1024 * 1024 // 10 Mo
        && request.resource.contentType.matches('^image/.*');
    }
  }
}
